<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Cart | MAY‚Äôs Handmade</title>

    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- ‚ö†Ô∏è Single-File Mandate: All CSS is inline -->
    <style>
        :root {
            --primary-color: #ff4081; /* Pink for accents (·Ä°·Äì·Ä≠·ÄÄ·Ä°·Äõ·Ä±·Ä¨·ÄÑ·Ä∫) */
            --primary-dark: #e73370;
            --primary-light: #ffe5ec; /* Light pink background (·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Ä∂·Ä°·Äñ·Äª·Ä±·Ä¨·Ä∑·Äõ·Ä±·Ä¨·ÄÑ·Ä∫) */
            --text-dark: #333;
            --text-medium: #555;
            --bg-light: #fff;
            --border-color: #f0f0f0;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --danger-color: #ff7070; /* Original light red */
            --danger-dark: #e94e4e; /* Darker red */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f7f7f7;
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* === HEADER STYLES === */
        body.cart-page header {
            position: fixed; top: 0; left: 0; width: 100%;
            background: var(--bg-light); box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000; display: flex; align-items: center;
            justify-content: space-between; padding: 10px 20px;
        }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo img { height: 45px; }
        .site-title {
            position: absolute; left: 50%; transform: translateX(-50%);
            font-family: 'Dancing Script', cursive; font-size: 1.6rem;
            color: var(--primary-color); margin: 0; white-space: nowrap;
        }
        .menu-toggle {
            cursor: pointer; font-size: 30px; display: none;
            background: none; border: none; color: #333;
        }
        nav ul {
            list-style: none; display: flex; gap: 20px;
            align-items: center; margin: 0; padding: 0;
        }
        nav ul li a {
            text-decoration: none; color: #333; font-weight: 500;
            transition: var(--transition);
        }
        nav ul li a:hover { color: var(--primary-color); }
        .cart-link { font-weight: 700 !important; color: var(--primary-color) !important; }
        
        /* Mobile Navigation Toggle */
        @media (max-width: 768px) {
            body.cart-page header { justify-content: flex-start; padding: 10px 16px; }
            .site-title { font-size: 1.5rem; }
            .menu-toggle { display: block; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); }
            nav ul {
                display: none; flex-direction: column; background: var(--bg-light);
                position: absolute; top: 70px; right: 20px; width: 200px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                border-radius: 12px; padding: 15px 0; z-index: 999;
            }
            nav ul.active { display: flex; animation: fadeIn 0.3s ease-in-out; }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
            nav ul li { text-align: right; margin: 8px 15px; }
        }

        /* === RESPONSIVE CART CONTAINER === */
        .cart-container {
            max-width: 1200px;
            margin: 120px auto 60px;
            padding: 20px; 
            display: grid;
            gap: 30px; 
            grid-template-columns: 1fr;
        }
        
        @media (min-width: 850px) {
            .cart-container {
                grid-template-columns: 2fr 1fr;
            }
        }

        /* Styling for List and Summary Wrappers */
        .cart-list-wrapper, .cart-summary-wrapper {
            background: var(--bg-light);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .cart-list-wrapper h2 { 
            text-align: center; margin-bottom: 20px; 
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .cart-summary-wrapper {
            height: fit-content;
        }

        .summary-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            color: var(--text-dark);
        }

        /* === CART ITEM STYLES === */
        .cart-item {
            display: grid;
            grid-template-columns: 80px 1fr auto; 
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            gap: 15px;
        }
        .cart-item:last-child { border-bottom: none; }

        @media (max-width: 550px) {
            .cart-item {
                grid-template-columns: 80px 1fr;
                grid-template-areas: 
                    "visuals details"
                    "controls controls"; 
                gap: 10px;
            }
            .item-visuals { grid-area: visuals; }
            .item-details-main { grid-area: details; }
            .item-controls-and-total { 
                grid-area: controls; 
                display: flex; 
                justify-content: space-between; 
                align-items: center;
                width: 100%;
                padding-top: 10px;
                border-top: 1px dashed var(--border-color);
            }
            .remove-btn { 
                position: absolute; 
                top: 15px; right: 0;
                padding: 5px 10px;
                font-size: 0.8rem;
                background: none;
                color: var(--danger-color);
                border: 1px solid var(--danger-color);
            }
            .remove-btn:hover { background: var(--danger-dark); color: white; transform: none; }
            .cart-item { position: relative; }
        }
        
        .item-visuals img { 
            width: 80px; height: 80px; 
            object-fit: cover; border-radius: 12px; 
        }
        .item-details-main h3 { margin: 0; font-size: 1.1rem; font-weight: 600; }
        .item-details-main p { margin: 0; font-size: 0.9rem; color: var(--text-medium); }
        
        .item-controls-and-total {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .item-total strong {
            font-size: 1.15rem;
            color: var(--primary-color);
            font-weight: 700;
            white-space: nowrap;
        }

        /* Quantity Controls (SIMPLIFIED - buttons removed) */
        .quantity-controls {
            display: flex; 
            align-items: center; 
            gap: 5px;
            margin-top: 0; 
            padding: 0; /* Removed padding */
            background: transparent; /* Removed background */
            border-radius: 0;
        }
        /* Removed .qty-btn styles as buttons are gone */
        .qty { 
            min-width: unset; 
            text-align: right; 
            font-weight: 500; 
            color: var(--text-medium); 
            font-size: 0.95rem; 
            white-space: nowrap;
        }

        /* Remove Button */
        .remove-btn {
            background: var(--danger-color); color: #fff; border: none;
            padding: 8px 14px; border-radius: 8px; cursor: pointer; 
            transition: var(--transition);
        }
        .remove-btn:hover { background: var(--danger-dark); transform: scale(1.05); }

        /* === TOTAL & ACTIONS === */
        .total-display { 
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            margin-top: 20px;
            line-height: 1.8;
            font-size: 1rem;
        }
        .total-display strong {
            font-size: 1.25rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        .delivery-note {
            text-align: left;
            font-size: 0.9rem;
            color: var(--text-medium);
            font-style: italic;
            margin-top: 10px;
            padding-bottom: 10px;
        }

        .cart-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        /* ENHANCED CHECKOUT BUTTON STYLE */
        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, #ff7ea5 100%);
            color: white;
            border: none;
            padding: 14px 25px; /* Slightly more padding */
            border-radius: 30px; /* More rounded */
            font-weight: 600;
            font-size: 1.05rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 6px 15px rgba(255, 64, 129, 0.4); /* Stronger shadow */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .checkout-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            box-shadow: 0 8px 20px rgba(255, 64, 129, 0.6);
            transform: translateY(-2px); /* Slight lift */
        }
        .checkout-btn:active {
            transform: translateY(1px); /* Press down effect */
            box-shadow: 0 3px 10px rgba(255, 64, 129, 0.4);
        }

        /* ENHANCED CLEAR CART BUTTON STYLE */
        #clear-cart {
            width: 100%;
            background: var(--bg-light);
            color: var(--danger-dark); /* Darker text for contrast */
            border: 2px solid var(--primary-light); /* Light border by default */
            padding: 12px 25px; 
            border-radius: 30px;
            font-weight: 500;
            transition: var(--transition);
        }
        #clear-cart:hover {
            background: var(--primary-light); /* Light pink background on hover */
            color: var(--danger-dark);
            border-color: var(--danger-dark); /* Red border on hover */
            transform: none;
        }
        #clear-cart i {
            margin-right: 5px;
        }

        footer { 
            margin-top: 40px; text-align: center; 
            color: var(--text-medium); font-size: 14px; 
            padding-bottom: 40px; 
        }

        /* === CHECKOUT MODAL STYLES === */
        #checkoutModal {
            display:none; position:fixed; inset:0;
            background:rgba(0,0,0,0.5);
            backdrop-filter: blur(3px);
            justify-content:center; align-items:center;
            z-index:2000;
        }
        #checkoutModal .modal-content {
            background:white;
            padding:25px;
            border-radius:16px;
            width:90%; max-width:400px;
            box-shadow:0 4px 15px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease-in-out;
        }
        #checkoutModal input, #checkoutModal textarea {
            width:100%; padding:10px; margin:8px 0;
            border:1px solid #ccc; border-radius:8px;
        }
        #checkoutModal h3 { text-align:center; color:var(--primary-color); margin-bottom:20px; }
        #checkoutModal label { font-weight: 500; font-size: 0.9rem; color: var(--text-medium);}
        #checkoutModal button {
            border:none; padding:10px 18px; border-radius:8px; cursor:pointer;
        }
        #cancelCheckout { background:#ccc; }
        #confirmCheckout { background:var(--primary-color); color:white; }
        
    </style>
</head>

<body class="cart-page">
    <header>
        <div class="logo">
            <!-- Used placeholder image URL for the logo -->
            <img src="https://placehold.co/45x45/ff4081/ffffff?text=M" alt="MAY‚Äôs Handmade Logo" />
        </div>
        <h1 class="site-title">MAY‚Äôs Handmade</h1>
        <button class="menu-toggle" id="menu-toggle">‚ò∞</button>
        <nav id="nav-menu">
            <ul>
                <li><a href="index.html#home">Home</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#products">Products</a></li>
                <li><a href="index.html#contact">Contact</a></li>
                <li><a href="cart.html" class="cart-link">üõçÔ∏è Cart (<span id="cart-count">0</span>)</a></li>
            </ul>
        </nav>
    </header>

    <!-- Cart Container (·ÄÖ·Äª·Ä±·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏ ·Äî·Ä±·Äõ·Ä¨) -->
    <section class="cart-container">
        
        <!-- 1. Cart Items List (·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏) -->
        <div class="cart-list-wrapper">
            <h2>Your Shopping Cart</h2>
            <div id="cart-items" class="cart-items">
                <!-- Items rendered here (·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äô·Äæ·Ä¨ ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Äº·Äû·Äï·Ä´·Äô·Ää·Ä∫) -->
            </div>
        </div>

        <!-- 2. Order Summary (·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ ·Ä°·ÄÄ·Äª·Äâ·Ä∫·Ä∏·ÄÅ·Äª·ÄØ·Äï·Ä∫) -->
        <div class="cart-summary-wrapper">
            <h3 class="summary-title">Order Summary</h3>
            <div id="cart-total" class="total-display">
                <!-- Total/Subtotal rendered here (·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏/·ÄÄ·Äª·Äû·ÄÑ·Ä∑·Ä∫·ÄÑ·ÄΩ·Ä±·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äô·Äæ·Ä¨ ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Äº·Äû·Äï·Ä´·Äô·Ää·Ä∫) -->
            </div>

            <p class="delivery-note">Cash on Delivery available ‚Ä¢ Mandalay only (·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ·ÄÑ·ÄΩ·Ä±·ÄÅ·Äª·Ä±·ÄÖ·Äî·ÄÖ·Ä∫·Äõ·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ää·Ä∫ ‚Ä¢ ·Äô·Äî·Äπ·Äê·Äú·Ä±·Ä∏·Äô·Äº·Ä≠·ÄØ·Ä∑·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·Ä¨)</p>

            <div class="cart-actions">
                <button id="checkout-btn" class="checkout-btn">
                    <i class="fas fa-arrow-right"></i> Proceed to Checkout
                </button>
                <button id="clear-cart" class="remove-btn">
                    <i class="fas fa-trash-alt"></i> Clear Cart
                </button>
            </div>
        </div>

    </section>

    <footer>
        <p>¬© 2025 MAY‚Äôs Handmade | Crafted with ‚ù§Ô∏è by MAY</p>
    </footer>

    <!-- Checkout Modal -->
    <div id="checkoutModal">
        <div class="modal-content">
            <h3>üõçÔ∏è Checkout Information (·Äô·Äæ·Ä¨·Äö·Ä∞·Äû·Ä∞ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫)</h3>
            <label for="cust-name">üë©‚Äçüíº Full Name (·Ä°·Äô·Ää·Ä∫·Ä°·Äï·Äº·Ää·Ä∑·Ä∫·Ä°·ÄÖ·ÄØ·Ä∂)</label>
            <input id="cust-name" type="text" placeholder="e.g. May Thu">

            <label for="cust-address">üè† Delivery Address (·Äï·Ä≠·ÄØ·Ä∑·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äõ·Äî·Ä∫·Äú·Ä≠·Äï·Ä∫·ÄÖ·Ä¨)</label>
            <textarea id="cust-address" placeholder="e.g. No.12, 40th Street, Mandalay"></textarea>

            <label for="cust-phone">üìû Phone Number (·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫)</label>
            <input id="cust-phone" type="tel" placeholder="09xxxxxxxxx">

            <div style="display:flex; justify-content:space-between; margin-top:20px;">
                <button id="cancelCheckout">Cancel (·Äñ·Äª·ÄÄ·Ä∫·Äû·Ä≠·Äô·Ä∫·Ä∏·Äô·Ää·Ä∫)</button>
                <button id="confirmCheckout">Confirm Order (·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äô·Ää·Ä∫)</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC (Javascript ·Äú·Ää·Ä∫·Äï·Äê·Ä∫·Äô·Äæ·ÄØ) -->
    <script>
        // ‚ö†Ô∏è Firestore/Auth is not needed for this modification. Sticking to localStorage and the existing structure.
        const SHEET_URL = "https://script.google.com/macros/s/AKfycbzDXeNqUzFEyKfs_NBFZAVY2SnP8d7N_kV-nbRAFw5KdKdd3aLXla-P0wRCc0N85aLX/exec";
        const cartContainer = document.getElementById('cart-items');
        const totalDisplay = document.getElementById('cart-total'); 
        const cartCount = document.getElementById('cart-count');
        const checkoutBtn = document.getElementById('checkout-btn');
        const clearBtn = document.getElementById('clear-cart');
        let deliveryFee = 0;

        // --- Utility Functions ---

        async function fetchDeliveryFee() {
            try {
                // Implementing exponential backoff for resilience
                let res;
                for (let i = 0; i < 3; i++) {
                    try {
                        res = await fetch(SHEET_URL);
                        if (res.ok) break;
                    } catch (e) {
                        // Wait (1s, 2s, 4s) before retrying
                        if (i < 2) await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
                        else throw e; // Throw error on final failure
                    }
                }

                if (!res || !res.ok) throw new Error("Failed to fetch data.");
                
                const data = await res.json();
                deliveryFee = data[0]?.deliveryFee ? parseInt(data[0].deliveryFee) : 3000;
            } catch (e) {
                console.warn("Could not fetch delivery fee, defaulting to 3000 MMK.", e);
                deliveryFee = 3000;
            }
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            cartCount.textContent = cart.reduce((sum, i) => sum + (i.qty || 1), 0);
        }

        /**
         * Renders the cart contents.
         * @param {Array<Object>} [cart] - Optional cart array. If not provided, loads from localStorage.
         */
        function renderCart(cart) {
            cartContainer.innerHTML = "";
            
            if (!cart) cart = JSON.parse(localStorage.getItem('cart')) || []; 

            if (cart.length === 0) {
                cartContainer.innerHTML = "<p style='text-align:center; color:#777; padding: 40px;'>Your cart is empty üëú<br>Add some beautiful handmade items!</p>";
                totalDisplay.innerHTML = "";
                checkoutBtn.style.display = "none";
                clearBtn.style.display = "none";
                updateCartCount();
                return;
            }

            checkoutBtn.style.display = "inline-flex";
            clearBtn.style.display = "flex";

            cart.forEach((item, index) => {
                const itemQty = item.qty || 1;
                const itemTotal = item.price * itemQty;
                
                // Use item.img or default placeholder
                const imageSource = item.img || 'https://placehold.co/80x80/cccccc/333333?text=BAG';

                const div = document.createElement("div");
                div.classList.add("cart-item");
                div.dataset.index = index;
                
                // üõë REMOVED Quantity Adjustment Buttons (+/-)
                div.innerHTML = `
                    <div class="item-visuals">
                        <img src="${imageSource}" 
                             alt="${item.name}" 
                             onerror="this.onerror=null; this.src='https://placehold.co/80x80/cccccc/333333?text=Error'">
                    </div>
                    <div class="item-details-main">
                        <h3>${item.name}</h3>
                        <p>${item.price.toLocaleString()} MMK each</p>
                    </div>
                    <div class="item-controls-and-total">
                        <div class="quantity-controls" data-index="${index}">
                            <span class="qty">Qty: ${itemQty}</span>
                        </div>
                        <p class="item-total"><strong>${itemTotal.toLocaleString()} MMK</strong></p>
                    </div>
                    <button class="remove-btn" title="Remove Item">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                cartContainer.appendChild(div);
            });

            updateTotalDisplay(cart);
            updateCartCount();
            attachCartEventListeners();
        }
        
        function attachCartEventListeners() {
            // üõë REMOVED: Event listeners for .minus and .plus buttons were here.
            
            document.querySelectorAll(".cart-item .remove-btn").forEach((btn) => {
                const index = parseInt(btn.closest(".cart-item").dataset.index);
                btn.onclick = () => {
                    const cart = JSON.parse(localStorage.getItem('cart')) || [];
                    cart.splice(index, 1); 
                    localStorage.setItem('cart', JSON.stringify(cart));
                    renderCart(cart); // ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏ ·Äï·Äº·Äî·Ä∫·ÄÅ·Ä±·Ä´·Ä∫·Äû·Ää·Ä∫
                };
            });
        }

        // üõë REMOVED: The entire changeQty function is no longer needed.

        function updateTotalDisplay(cart) {
            const subtotal = cart.reduce((sum, i) => sum + (i.price * (i.qty || 1)), 0);
            const total = subtotal + deliveryFee;
            totalDisplay.innerHTML = `
                <div style="display:flex; justify-content:space-between;"><span>Subtotal:</span> <span>${subtotal.toLocaleString()} MMK</span></div>
                <div style="display:flex; justify-content:space-between;"><span>Delivery Fee:</span> <span>${deliveryFee.toLocaleString()} MMK</span></div>
                <div style="display:flex; justify-content:space-between; font-size: 1.1rem; padding-top: 10px;">
                    <strong>Grand Total:</strong> 
                    <strong style="color: var(--primary-color);">${total.toLocaleString()} MMK</strong>
                </div>
            `;
        }

        // --- Modal/Confirmation Logic (Replacing alert/confirm with simplified modal logic) ---
        const modal = document.getElementById("checkoutModal");
        const confirmBtn = document.getElementById("confirmCheckout");
        const cancelBtn = document.getElementById("cancelCheckout");

        // Simple Message Box for alerts
        function showMessage(message) {
            const tempModal = document.createElement('div');
            tempModal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:9999; backdrop-filter:blur(3px);';
            tempModal.innerHTML = `
                <div style="background:white; padding:30px; border-radius:12px; max-width:300px; text-align:center; box-shadow:0 8px 16px rgba(0,0,0,0.3);">
                    <p style="margin-bottom:20px; font-weight:500;">${message}</p>
                    <button onclick="document.body.removeChild(this.closest('div').parentNode)" style="background:var(--primary-color); color:white; border:none; padding:8px 15px; border-radius:6px; cursor:pointer;">OK</button>
                </div>
            `;
            document.body.appendChild(tempModal);
        }

        // üõë FIX: Clear Cart logic updated to use event listeners instead of inline onclick 
        // to prevent scope issues, ensuring the modal is correctly removed.
        clearBtn.addEventListener("click", () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                return showMessage("Cart is already empty! (·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äë·Ä≤·Äê·ÄΩ·ÄÑ·Ä∫ ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´)");
            }

            const confirmationModal = document.createElement('div');
            confirmationModal.classList.add('confirmation-modal');
            confirmationModal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:9999; backdrop-filter:blur(3px);';
            confirmationModal.innerHTML = `
                <div id="confirmationBox" style="background:white; padding:30px; border-radius:12px; max-width:350px; text-align:center; box-shadow:0 8px 16px rgba(0,0,0,0.3);">
                    <p style="margin-bottom:20px; font-weight:600;">Are you sure you want to clear your cart? (·ÄÖ·Äª·Ä±·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·Äõ·Äæ·ÄÑ·Ä∫·Ä∏·Äô·Äú·Ä¨·Ä∏?)</p>
                    <button id="confirmClearYes" style="background:var(--danger-color); color:white; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; margin-right:10px;">Yes, Clear</button>
                    <button id="confirmClearNo" style="background:#ccc; color:#333; border:none; padding:10px 18px; border-radius:8px; cursor:pointer;">Cancel</button>
                </div>
            `;
            document.body.appendChild(confirmationModal);
            
            const confirmYes = document.getElementById('confirmClearYes');
            const confirmNo = document.getElementById('confirmClearNo');

            const removeModal = () => {
                document.body.removeChild(confirmationModal);
            }

            confirmYes.addEventListener('click', () => {
                removeModal();
                localStorage.removeItem("cart");
                renderCart([]);
            });

            confirmNo.addEventListener('click', () => {
                removeModal();
            });
            
            // Allow clicking outside to close
            confirmationModal.addEventListener('click', (e) => {
                if (e.target === confirmationModal) {
                    removeModal();
                }
            });
        });

        // Checkout button click handler
        checkoutBtn.addEventListener("click", () => {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0) {
                return showMessage("Your cart is empty! (·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äë·Ä≤·Äê·ÄΩ·ÄÑ·Ä∫ ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äõ·Äæ·Ä≠·Äï·Ä´)");
            }
            modal.style.display = "flex";
        });

        cancelBtn.onclick = () => (modal.style.display = "none");

        // Order Confirmation handler
        confirmBtn.onclick = () => {
            const name = document.getElementById("cust-name").value.trim();
            const address = document.getElementById("cust-address").value.trim();
            const phone = document.getElementById("cust-phone").value.trim();

            if (!name || !address || !phone) return showMessage("‚ö†Ô∏è Please fill all fields. (·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Ä°·Äï·Äº·Ää·Ä∑·Ä∫·Ä°·ÄÖ·ÄØ·Ä∂ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´)"); 
            if (!/^09\d{8,9}$/.test(phone)) return showMessage("‚ö†Ô∏è Invalid phone number. (·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫ 09 ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·ÄÖ·Äê·ÄÑ·Ä∫·Äû·Ä±·Ä¨ ·Äî·Ä∂·Äï·Ä´·Äê·Ä∫ ·Äô·Äæ·Äî·Ä∫·Äô·Äô·Äæ·Äî·Ä∫ ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äï·Ä´)");

            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const subtotal = cart.reduce((s, i) => s + i.price * (i.qty || 1), 0);
            const total = subtotal + deliveryFee;

            const orderData = {
                Name: name,
                Address: address,
                Phone: "+95" + phone.substring(1),
                Subtotal: subtotal + " MMK",
                DeliveryFee: deliveryFee + " MMK",
                Total: total + " MMK",
                Items: cart.map(i => `${i.name} x${i.qty || 1}`).join(", "),
                Time: new Date().toLocaleString()
            };

            modal.style.display = "none";
            showMessage("üôè ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äê·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫! ·Äû·ÄÑ·Ä∑·Ä∫ order ·ÄÄ·Ä≠·ÄØ confirm ·Äú·ÄØ·Äï·Ä∫·Äñ·Ä≠·ÄØ·Ä∑ ·ÅÇ·ÅÑ ·Äî·Ä¨·Äõ·ÄÆ·Ä°·Äê·ÄΩ·ÄÑ·Ä∫·Ä∏ ·Äï·Äº·Äî·Ä∫·Äú·Ää·Ä∫ ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äï·Ä´·Äô·Äö·Ä∫·Åã");

            localStorage.removeItem("cart");
            renderCart([]);

            // Send data to Formspree
            fetch("https://formspree.io/f/xkgqqoev", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(orderData)
            }).catch(console.warn);
        };

        modal.addEventListener("click", e => { if (e.target === modal) modal.style.display = "none"; });

        // --- Menu Toggle Logic ---
        const menuToggle = document.getElementById('menu-toggle');
        const navMenu = document.getElementById('nav-menu').querySelector('ul');
        menuToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });
        
        // --- Initial Load (·ÄÖ·Äê·ÄÑ·Ä∫ Loading) ---
        window.onload = async () => { 
            // üõë Removed mock cart data initialization.
            
            await fetchDeliveryFee(); // üì¶ ·Äï·Ä≠·ÄØ·Ä∑·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·ÄÅ·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äô·Äæ·Ä¨ ·Äê·ÄÖ·Ä∫·ÄÅ·Ä´·Äû·Ä¨ ·ÄÜ·ÄΩ·Ä≤·Äö·Ä∞·Äï·Ä´·Äô·Ää·Ä∫·Åã
            
            // Replaced alert() and confirm() with custom modal/message box functions (Good practice)
            renderCart();
        };
    </script>
</body>
</html>
